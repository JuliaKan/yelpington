<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="muddy-waters.css" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
  <style>
  </style>

</head>


<body>
  <div id="mainText">
    <h1 id="name"></h1>
    <h2 id="address"></h2>
    <h3 id="phoneNumber"></h3>
    <h4 id="notes"></h4>
  </div>

  <iframe id="map"
  title="map"
  width="300"
  height="200"
  src="">
</iframe>

 

  <script>
    // Access query parameters: "/?name=muddy-waters", for instance.
    let params = new URLSearchParams(document.location.search.slice(1));
    // In this particular case, by using the ID "name" instead of a specific filename, you can put the name of any JSON in the URL and access it - brilliant!
    let fileName = params.get("name")+".json";
    console.log(fileName);
    
    //fetch().then().then()
    //the fetch returns a promise. when that promise resolves/finishes, it pass the promise to the .then. the promise can be successful thing or error.
    fetch(fileName)
      .then(function (response) {
        // actually converts string into javascript object.
        return response.json();//text to object!!
      })
      .then(function (myJson) {
        // telling the DOM exactly where to put a piece from the JS Object. assigning name value to name id.
        document.getElementById("name").textContent = myJson.name
        document.getElementById("address").textContent = myJson.address
        document.getElementById("phoneNumber").textContent = myJson.phonenumber
        document.getElementById("notes").textContent = myJson.notes
        
        
        let apiUrl = "https://nominatim.openstreetmap.org/search?q=" + myJson.address + "&format=json"

        fetch(apiUrl).then(function(response){
          return response.json()
          //let package = response.json();
          //console.log(package);

          // let boundingBoxHolder = package[0].boundingbox
          //return package[0].boundingbox
          //console.log(boundingBoxHolder)

          //the package needs to be ONLY the address.


        }).then(function(package){
         let nominatimResponse = package[0] 
         let b1 = nominatimResponse.boundingbox[0]
         let b2 = nominatimResponse.boundingbox[1]
         let b3 = nominatimResponse.boundingbox[2]
         let b4 = nominatimResponse.boundingbox[3]
        
        let openStreetMapsUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${b3}%2C${b1}%2C${b4}%2C${b2}`
          document.getElementById("map").src=openStreetMapsUrl

          //add marker using coordinate variable from the line below here:
          //}&amp;layer=mapnik&amp;marker=44.4760630180706%2C-73.21197599172592
          console.log (openStreetMapsUrl)

         //this is documentation for map embed
         //"https://www.openstreetmap.org/export/embed.html?bbox=-73.21300327777864%2C44.475507992540564%2C-73.21094870567323%2C44.476618038321554&amp;layer=mapnik&amp;marker=44.4760630180706%2C-73.21197599172592"
        })




        console.log(myJson);
      });
  </script>

</body>


</html>